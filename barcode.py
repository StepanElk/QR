import matplotlib.pyplot as plt
import numpy as np

values = """
!
"
#
$
%
&
'
(
)
*
+
,
-
.
/
0
1
2
3
4
5
6
7
8
9
:
;
<
=
>
?
@
A
B
C
D
E
F
G
H
I
J
K
L
M
N
O
P
Q
R
S
T
U
V
W
X
Y
Z
[
&
]
^
_
`
a
b
c
d
e
f
g
h
i
j
k
l
m
n
o
p
q
r
s
t
u
v
w
x
y
z
{
|
}
~
"""
code128 = """
11011001100
11001101100
11001100110
10010011000
10010001100
10001001100
10011001000
10011000100
10001100100
11001001000
11001000100
11000100100
10110011100
10011011100
10011001110
10111001100
10011101100
10011100110
11001110010
11001011100
11001001110
11011100100
11001110100
11101101110
11101001100
11100101100
11100100110
11101100100
11100110100
11100110010
11011011000
11011000110
11000110110
10100011000
10001011000
10001000110
10110001000
10001101000
10001100010
11010001000
11000101000
11000100010
10110111000
10110001110
10001101110
10111011000
10111000110
10001110110
11101110110
11010001110
11000101110
11011101000
11011100010
11011101110
11101011000
11101000110
11100010110
11101101000
11101100010
11100011010
11101111010
11001000010
11110001010
10100110000
10100001100
10010110000
10010000110
10000101100
10000100110
10110010000
10110000100
10011010000
10011000010
10000110100
10000110010
11000010010
11001010000
11110111010
11000010100
10001111010
10100111100
10010111100
10010011110
10111100100
10011110100
10011110010
11110100100
11110010100
11110010010
11011011110
11011110110
11110110110
10101111000
10100011110
10001011110
"""

values = values.split()
values = [" "] + values
codes = dict(zip(values, code128.split()))
start = '11010010000'
stop = '1100011101011'

pixel_per_bar = 4
dpi = 100

def controlSum(string):
    order = 1
    sum = 104
    for sym in string:
        print(sym , values.index(sym),order)
        sum += (values.index(sym))*order
        order +=1
    print(sum , sum%103 , code128[sum%103])
    # sum = '{:0>11}'.format(str(bin(sum)))[2:]
    return sum%103

def getBinString(string):
    bin = ["00000000000" , start]
    bin += [codes[x] for x in string]
    bin += [code128.split()[controlSum(string)] , stop,"00000000000" ]
    print(bin)
    return bin

def run():
    input = 'HELLO WORD!'
    bin = getBinString(input)
    arr = []
    for val in bin:
        arr+= [int(x) for x in val]
    draw(np.array(arr))

def draw(code):
    fig = plt.figure(figsize=(len(code) * pixel_per_bar / dpi, 2), dpi=dpi)
    ax = fig.add_axes([0, 0, 1, 1]) 
    ax.set_axis_off()
    ax.imshow(code.reshape(1, -1), cmap='binary', aspect='auto',
            interpolation='nearest')
    plt.show()

run()